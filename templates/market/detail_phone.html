{% extends 'base.html' %}
{% load static %}
{% block lists %}
  Детальная страница
{% endblock %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/detail_phone.css' %}" />

  <main>
    <h1 class="text-body-emphasis">{{ smartphone.brand }} {{ smartphone.model }}</h1>
    <p class="fs-5 W-80">Quickly and easily get started with Bootstrap's compiled, production-ready files with this barebones example featuring some basic HTML and helpful links. Download all our examples to get started.</p>
    {% for image in smartphone.images.all %}
      <img src="{{ image.images.url }}" alt="Фото смартфона" style="width: 300px;" />
    {% endfor %}
    <h3 class="text-end">{{ smartphone.price|floatformat:0 }}</h3>
    <hr class="my-4" />
    <div class="row g-5">
      <div class="col-md-6">
        <h2 class="text-body-emphasis">Характеристики</h2>
        <div class="text-start">
          <p>Бренд: {{ smartphone.brand }}</p>
          <p>Модель: {{ smartphone.model }}</p>
          <p>Размер экрана: {{ smartphone.display_size }}</p>
          <p>Объем встроенной памяти: {{ smartphone.storage_capacity }}</p>
          <p>Процессор: {{ smartphone.processor }}</p>
          <p>Объем батареи: {{ smartphone.battery_capacity }}</p>
        </div>
      </div>

      <div class="col-md-6">
        <h2 class="text-body-emphasis">Описание</h2>
        <p class="text-start">{{ smartphone.description }}</p>
        <h6 class="text-end">Дата добавления: {{ smartphone.created_at }}</h6>
      </div>
    </div>
    <div class="mb-4 mt-3"></div>

    <div class="row">
      <div class="col-sm-6 mb-3 mb-sm-0">
        <p>Оценка: {{ smartphone.grade }}</p>
      </div>
      <div class="col-sm-6">
        <a href="#" id="addToBasket" data-smartphone-id="{{ smartphone.pk }}" class="btn btn-primary btn-lg px-4 text-end">Купить</a>
      </div>
    </div>
    {% if user.is_authenticated %}
      <a href="{% url 'market:smartphone_delete' smartphone.pk %}">Delete</a>

      <a href="{% url 'market:smartphone_edit' smartphone.pk %}">Edit</a>
    {% endif %}
  </main>


  {% if user.is_authenticated %}
  <div>
    <a href="{% url 'comments:create_comment' smartphone.pk %}">Добавить комментарий</a>
  </div>
{% endif %}
<div style="margin-bottom: 300px;">
  {% for comment in comments %}
    {{ comment.author }}
    {{ comment.content }}
    {{ comment.created_at }}

    {% if user == comment.author %}
    <a href="{% url 'comments:delete_comment' comment.pk %}">Delete comment</a>
    <a href="{% url 'comments:edit_comment' comment.pk %}">Edit comment</a>
    {% endif %}

  {% endfor %}
</div>
<script>
  const addToBasket = document.getElementById('addToBasket');
  addToBasket.addEventListener("click", addPhoneTobasket)
  
  function addPhoneTobasket() {
      const smartphoneId = this.getAttribute('data-smartphone-id'); // Получаем ID смартфона
      $.ajax({
          url: '/orders/add_to_basket/',
          method: 'POST',
          data: {"smartphone_id": smartphoneId, "status": 'ok'}, // Передаем ID смартфона
          headers: {
              "X-CSRFToken": getCookie("csrftoken")
          },
      })
  }
  

function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + "=")) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
          }
      }
  }
  return cookieValue;
}


</script>

{% endblock %}
